(function(t){window.wc_braintree={utils:{}},wc_braintree.BaseGateway=function(){this.gateway_id=this.params.gateway,this.container="li.payment_method_"+this.gateway_id,this.nonce_selector="[name=\""+this.params.nonce_selector+"\"]",this.device_data_selector="[name=\""+this.params.device_data_selector+"\"]",this.tokenized_response_selector="[name=\""+this.params.tokenized_response_selector+"\"]",t(document.body).on("wc_braintree_refreshed_token",this.set_refresh_token.bind(this)),t(document.body).on("wc_braintree_client_created",this.create_instance.bind(this)),this.initialize()},wc_braintree.BaseGateway.prototype.create_instance=function(){},wc_braintree.BaseGateway.prototype.getBrowserLocales=function(){var e=window.navigator,t=e.languages?Array.prototype.slice.apply(e.languages):[];return e.language&&t.push(e.language),e.userLanguage&&t.push(e.userLanguage),t.map(function(e){if(e&&e.match(/^[a-z]{2}[-_][A-Z]{2}$/)){var t=e.split(/[-_]/),a=t[0];return{country:t[1],lang:a}}return e&&e.match(/^[a-z]{2}$/)?{lang:e}:null}).filter(Boolean)},wc_braintree.BaseGateway.prototype.block=function(){t.blockUI({message:null,overlayCSS:{background:"#fff",opacity:.6}})},wc_braintree.BaseGateway.prototype.unblock=function(){t.unblockUI()},wc_braintree.BaseGateway.prototype.set_refresh_token=function(t,e){this.params._wp_rest_nonce=e},wc_braintree.BaseGateway.prototype.get_cart_total=function(){return t("#wc_braintree_cart_total").val()},wc_braintree.BaseGateway.prototype.set_cart_total=function(e){return t("#wc_braintree_cart_total").val(e)},wc_braintree.BaseGateway.prototype.get_recurring_cart_total=function(){return t("#wc_braintree_recurring_cart_total").val()},wc_braintree.BaseGateway.prototype.has_recurring_total=function(){return 0<t("#wc_braintree_recurring_cart_total").length},wc_braintree.BaseGateway.prototype.get_currency=function(){return t("#wc_braintree_cart_currency").val()},wc_braintree.BaseGateway.prototype.get_button=function(){return this.$button},wc_braintree.BaseGateway.prototype.get_merchant_account=function(){return t("#wc_braintree_merchant_account").val()},wc_braintree.BaseGateway.prototype.set_device_data=function(){this.dataCollectorInstance&&t(this.device_data_selector).val(this.dataCollectorInstance.deviceData)},wc_braintree.BaseGateway.prototype.set_nonce=function(e){t(this.nonce_selector).val(e)},wc_braintree.BaseGateway.prototype.get_form=function(){return t(this.container).closest("form")},wc_braintree.BaseGateway.prototype.needs_shipping=function(){return"1"===this.params.needs_shipping},wc_braintree.BaseGateway.prototype.initialize=function(){},wc_braintree.BaseGateway.prototype.is_valid_checkout=function(){return!0},wc_braintree.BaseGateway.prototype.form_to_data=function(e){var a=e.find("input").filter(function(a,o){return!t(o).is("[name^=\"add-to-cart\"]")}.bind(this)).serializeArray(),o={};for(var n in a){var r=a[n];o[r.name]=r.value}return o},wc_braintree.BaseGateway.prototype.add_to_cart=function(a){return a&&a.preventDefault(),new Promise(function(e,a){this.block();var o={product_id:this.get_product_data().post_id,variation_id:t("[name=\"variation_id\"]").val(),qty:this.get_product_quantity(),payment_method:this.gateway_id};t.ajax({url:this.params.routes.add_to_cart,method:"POST",dataType:"json",data:o,beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",this.params._wp_rest_nonce)}.bind(this),success:function(a,o,n){return this.unblock(),t(document.body).triggerHandler("wc_braintree_refreshed_token",n.getResponseHeader("X-WP-Nonce")),a.success?void e(a):void this.submit_error(a.messages)}.bind(this),error:function(e,t,o){this.unblock(),this.submit_error(o),a(o)}.bind(this)})}.bind(this))},wc_braintree.BaseGateway.prototype.process_order=function(){if(!this.is_valid_checkout())return void this.submit_error(this.params.messages.terms);var e=t.extend({},this.form_to_data(this.get_form()),{payment_method:this.gateway_id},this.get_process_order_data());this.block(),t.ajax({method:"POST",url:this.params.routes.checkout,data:e,dataType:"json",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",this.params._wp_rest_nonce)}.bind(this),success:function(e){return e.reload?void window.location.reload():void("success"===e.result?window.location=e.redirect:(e.messages&&this.submit_error(e.messages),this.set_nonce(""),this.unblock()))}.bind(this),error:function(e,t,a){this.set_nonce(""),this.submit_error(a),this.unblock()}.bind(this)})},wc_braintree.BaseGateway.prototype.update_shipping_address=function(e){return new Promise(function(a,o){t.ajax({method:"POST",url:this.params.routes.shipping_address,data:{payment_method:this.gateway_id,address:e},dataType:"json",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",this.params._wp_rest_nonce)}.bind(this),success:function(e){e.code?o(e):a(e)}.bind(this),error:function(e,t,a){o(e,t,a)}.bind(this)})}.bind(this))},wc_braintree.BaseGateway.prototype.update_shipping_method=function(e){return new Promise(function(a,o){t.ajax({method:"POST",url:this.params.routes.shipping_method,data:{payment_method:this.gateway_id,shipping_methods:e},dataType:"json",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",this.params._wp_rest_nonce)}.bind(this),success:function(e){e.code?o(e):(this.set_selected_shipping_method(e.data.chosen_shipping_methods),a(e))}.bind(this),error:function(){o()}.bind(this)})}.bind(this))},wc_braintree.BaseGateway.prototype.get_process_order_data=function(){return{}},wc_braintree.BaseGateway.prototype.map_shipping_address=function(){},wc_braintree.BaseGateway.prototype.set_selected_shipping_method=function(e){if(e&&t("[name^=\"shipping_method\"]").length)for(var a in e)t("[name=\"shipping_method["+a+"]\"][value=\""+e[a]+"\"]").prop("checked",!0).trigger("change")},wc_braintree.BaseGateway.prototype.initialize_fraud_tools=function(){this.params.advanced_fraud.enabled&&braintree.dataCollector.create(this.get_fraud_tool_options(),function(e,t){return e?"DATA_COLLECTOR_KOUNT_NOT_ENABLED"===e.code?void 0:void this.submit_error(e):void(this.dataCollectorInstance=t)}.bind(this))},wc_braintree.BaseGateway.prototype.get_fraud_tool_options=function(){return{client:this.clientInstance,kount:!0}},wc_braintree.BaseGateway.prototype.on_payment_method_received=function(){},wc_braintree.BaseGateway.prototype.submit_error=function(e){this.clear_error(),t(document.body).triggerHandler("wc_braintree_submit_error",{error:e,element:this.message_container})},wc_braintree.BaseGateway.prototype.clear_error=function(){t("#wc_braintree_checkout_error").remove()},wc_braintree.BaseGateway.prototype.terms_updated=function(){},wc_braintree.BaseGateway.prototype.get_first_name=function(e){return t(e+"_first_name").length?t(e+"_first_name").val():""},wc_braintree.BaseGateway.prototype.get_last_name=function(e){return t(e+"_last_name").length?t(e+"_last_name").val():""},wc_braintree.BaseGateway.prototype.get_shipping_prefix=function(){return"#billing"},wc_braintree.CartGateway=function(){this.container="li.wc_braintree_cart_gateway_"+this.gateway_id,this.message_container=".shop_table",this.form_id="#wc-braintree-cart-fields-form",t(document.body).on("change","[name=\"terms\"]",this.terms_updated.bind(this))},wc_braintree.CartGateway.prototype.needs_shipping=function(){return 1===t("#wc_braintree_needs_shipping").data("value")},wc_braintree.CartGateway.prototype.on_payment_method_received=function(){this.process_order()},wc_braintree.CartGateway.prototype.get_form=function(){return t(this.form_id)},wc_braintree.CartGateway.prototype.is_valid_checkout=function(){return!t("[name=\"terms\"]").length||t("[name=\"terms\"]").is(":checked")},wc_braintree.CartGateway.prototype.get_cart_total=function(){return t("#wc_braintree_cart_total").val()},wc_braintree.ProductGateway=function(){this.container="li.wc_braintree_product_gateway_"+this.gateway_id,this.message_container="div.product",this.buttonWidth=t("div.quantity").outerWidth(!0)+t(".single_add_to_cart_button").outerWidth(),this.get_form().on("found_variation",this.found_variation.bind(this)),this.get_form().on("reset_data",this.reset_variation_data.bind(this)),t(this.container).css("max-width",this.buttonWidth+"px")},wc_braintree.ProductGateway.prototype.on_payment_method_received=function(){this.process_order()},wc_braintree.ProductGateway.prototype.get_product_data=function(){return t("#wc_braintree_product_data").data("product")},wc_braintree.ProductGateway.prototype.set_product_data=function(e){return t("#wc_braintree_product_data").data("product",e)},wc_braintree.ProductGateway.prototype.get_product_quantity=function(){return parseInt(t("[name=\"quantity\"]").val())},wc_braintree.ProductGateway.prototype.get_product_amount=function(){return this.get_product_data().price*this.get_product_quantity()},wc_braintree.ProductGateway.prototype.found_variation=function(t,e){var a=this.get_product_data();a.price=e.display_price,a.needs_shipping=!e.is_virtual,this.set_product_data(a),this.$button&&this.get_button().prop("disabled",!1).removeClass("disabled")},wc_braintree.ProductGateway.prototype.reset_variation_data=function(){this.$button&&this.get_button().prop("disabled",!0).addClass("disabled")},wc_braintree.ProductGateway.prototype.needs_shipping=function(){return this.get_product_data().needs_shipping},wc_braintree.CheckoutGateway=function(){this.token_selector="[name=\""+this.params.token_selector+"\"]",this.payment_type_selector="[name=\""+this.params.payment_type_selector+"\"]",this.container=this.message_container="li.payment_method_"+this.gateway_id,this.banner_container=".wc_braintree_banner_gateway_"+this.gateway_id,this.list_container="li.payment_method_"+this.gateway_id,this.banner_enabled="1"===this.params.banner_enabled,t(this.container).closest("form").on("checkout_place_order_"+this.gateway_id,this.pre_submit_validations.bind(this)),t(this.container).closest("form").on("checkout_place_order_"+this.gateway_id,this.woocommerce_form_submit.bind(this)),t(document.body).on("wc_braintree_pre_form_submit_"+this.gateway_id,this.set_device_data.bind(this)),t(document.body).on("updated_checkout",this.updated_checkout.bind(this)),t(document.body).on("checkout_error",this.checkout_error.bind(this)),t(document.body).on("change","[name=\"terms\"]",this.terms_updated.bind(this)),this.banner_enabled&&t(".woocommerce-billing-fields").length&&t(this.banner_container).css("max-width",t(".woocommerce-billing-fields").outerWidth(!0)),this.order_review()},wc_braintree.CheckoutGateway.prototype.on_payment_method_received=function(e){this.tokenize_response=e,this.payment_method_received=!0,this.set_nonce(e.nonce),this.hide_payment_button(),this.show_place_order()},wc_braintree.CheckoutGateway.prototype.order_review=function(){var e=window.location.href,t=e.match(/order_review.+payment_method=([\w]+).+payment_nonce=(.+)/);if(t&&1<t.length){var a=t[1],o=t[2];this.gateway_id===a&&(this.payment_method_received=!0,this.set_nonce(o),this.set_use_nonce_option())}},wc_braintree.CheckoutGateway.prototype.hide_payment_button=function(){this.$button&&this.$button.hide()},wc_braintree.CheckoutGateway.prototype.hide_place_order=function(){t("#place_order").addClass("wc-braintree-hide")},wc_braintree.CheckoutGateway.prototype.show_place_order=function(){t("#place_order").removeClass("wc-braintree-hide")},wc_braintree.CheckoutGateway.prototype.get_shipping_prefix=function(){return this.needs_shipping()&&t("[name=\"ship_to_different_address\"]").is(":checked")?"#shipping":"#billing"},wc_braintree.CheckoutGateway.prototype.woocommerce_form_submit=function(){return!!this.is_payment_method_selected()||this.payment_method_received},wc_braintree.CheckoutGateway.prototype.is_valid_checkout=function(){return!t("[name=\"terms\"]").length||t("[name=\"terms\"]").is(":checked")},wc_braintree.CheckoutGateway.prototype.pre_submit_validations=function(t){return!!this.is_valid_checkout()||(t.stopImmediatePropagation(),this.submit_error(this.params.messages.terms),!1)},wc_braintree.CheckoutGateway.prototype.payment_gateway_changed=function(t,e){e===this.gateway_id?this.is_payment_method_selected()||this.payment_method_received?(this.$button.hide(),this.show_place_order()):(this.$button.show(),this.hide_place_order()):this.$button.hide()},wc_braintree.CheckoutGateway.prototype.create_button=function(){},wc_braintree.CheckoutGateway.prototype.updated_checkout=function(){this.create_button(),this.payment_method_received&&t("#"+this.gateway_id+"_use_nonce").trigger("click")},wc_braintree.CheckoutGateway.prototype.checkout_error=function(){this.is_gateway_selected()&&this.has_checkout_error()&&(this.payment_method_received=!1,this.tokenize_response=null,this.payment_gateway_changed(null,this.gateway_id))},wc_braintree.CheckoutGateway.prototype.is_gateway_selected=function(){return this.get_selected_gateway()===this.gateway_id},wc_braintree.CheckoutGateway.prototype.get_selected_gateway=function(){return t("input[name=\"payment_method\"]:checked").val()},wc_braintree.CheckoutGateway.prototype.has_checkout_error=function(){return 0<t("#wc_braintree_checkout_error").length},wc_braintree.CheckoutGateway.prototype.is_payment_method_selected=function(){return!!t(this.token_selector).length&&"token"===t(this.payment_type_selector+":checked").val()},wc_braintree.CheckoutGateway.prototype.display_saved_methods=function(t,e){this.gateway_id==e&&this.$button&&(this.$button.hide(),this.show_place_order())},wc_braintree.CheckoutGateway.prototype.display_new_payment_method_container=function(t,e){this.gateway_id==e&&this.$button&&!this.payment_method_received&&(this.$button.show(),this.hide_place_order())},wc_braintree.CheckoutGateway.prototype.needs_shipping=function(){return"1"===this.params.needs_shipping},wc_braintree.CheckoutGateway.prototype.get_payment_token=function(){return t(this.token_selector).val()},wc_braintree.blockUI={message:null,overlayCSS:{background:"#fff",opacity:.6}},wc_braintree.CheckoutGateway.prototype.set_use_nonce_option=function(e){t("#"+this.gateway_id+"_use_nonce").prop("checked",e).trigger("click")},wc_braintree.CheckoutGateway.prototype.set_payment_method=function(e){t("[name=\"payment_method\"][value=\""+e+"\"]").prop("checked",!0).trigger("click")},wc_braintree.PayPal=function(){if(wc_braintree.BaseGateway.call(this),"undefined"==typeof this.get_amount)throw"Instance must have get_amount function";this.create_button()},wc_braintree.PayPal.prototype=Object.create(wc_braintree.BaseGateway.prototype),wc_braintree.PayPal.prototype.create_instance=function(t,e,a){return new Promise(function(t,o){this.clientInstance=e,this.client_token=a,this.initialize_fraud_tools(),braintree.paypalCheckout.create({client:e,authorization:a,merchantAccountId:this.get_merchant_account()},function(e,a){return e?(this.submit_error(e),void o()):void(this.paypalInstance=a,t())}.bind(this))}.bind(this))},wc_braintree.PayPal.prototype.get_fraud_tool_options=function(){return t.extend({},wc_braintree.BaseGateway.prototype.get_fraud_tool_options.call(this),{paypal:!0})},wc_braintree.PayPal.prototype.create_button=function(){return new Promise(function(e){this.get_button_container().find(".paypal-button").remove(),paypal.Button.render(this.render_options(),this.get_button_container()[0]),this.$button=this.get_button_container().find(".paypal-button"),e()}.bind(this))},wc_braintree.PayPal.prototype.render_options=function(){var e={locale:this.params.locale,style:this.params.button_style,funding:this.get_funding(),env:this.params.environment,validate:function(e){this.actions=e}.bind(this),onClick:function(){}.bind(this),payment:function(e,t){var a=this.get_options();this.paypalInstance.createPayment(a,function(o,n){o&&(""==this.get_merchant_account()?o.code="PAYPAL_MERCHANT_ACCOUNT_EMPTY":a.shippingAddressOverride&&(o.code="PAYPAL_INVALID_ADDRESS"),this.submit_error(o),t(o)),e(n)}.bind(this))}.bind(this),onAuthorize:function(e,a){return this.paypalInstance.tokenizePayment(e,function(o,n){this.tokenize_response=n,this.set_nonce(n.nonce),this.set_device_data(),this.payment_method_received=!0,this.update_addresses(n.details),t("[name=\"payment_method\"]").val(this.gateway_id),this.on_payment_method_received(n,e,a)}.bind(this))}.bind(this),onCancel:function(){},onError:function(e){-1<e.message.indexOf("props.locale")?this.submit_error(this.params.messages.invalid_locale):this.submit_error(e)}.bind(this)};this.needs_shipping()&&"checkout"===this.params.options.flow&&(e.onShippingChange=function(e,t){var a=e.shipping_address;this.update_shipping_address({city:a.city,state:a.state,postcode:a.postal_code,country:a.country_code}).then(function(){t.resolve()}).catch(function(){t.reject()})}.bind(this));var a=null,o=this.getBrowserLocales(),n=!!(0<o.length)&&o[0].lang+"_"+o[0].country;return n&&(a=n.match(/([\w]{2})_undefined/))&&(n=a[1]+"_"+a[1].toUpperCase()),n&&-1<this.params.locales.indexOf(n)&&(e.locale=n),e},wc_braintree.PayPal.prototype.get_user_locale=function(){var e=null,t=this.getBrowserLocales(),a=!!(0<t.length)&&t[0].lang+"_"+t[0].country;return a&&(e=a.match(/([\w]{2})_undefined/))&&(a=e[1]+"_"+e[1].toUpperCase()),a&&-1<this.params.locales.indexOf(a)?a:this.params.locale},wc_braintree.PayPal.prototype.get_options=function(){var e={amount:this.get_amount(),enableShippingAddress:this.needs_shipping(),shippingAddressEditable:this.needs_shipping()};if(this.needs_shipping()){var a=this.get_shipping_prefix();this.valid_address(this.get_address_object(a),a)&&(e.shippingAddressOverride=this.get_address_object(a))}var e=t.extend({},this.params.options,e);return e.locale=this.get_user_locale(),e},wc_braintree.PayPal.prototype.get_funding=function(){return{allowed:[],disallowed:[paypal.FUNDING.CREDIT,paypal.FUNDING.CARD,paypal.FUNDING.VENMO,paypal.FUNDING.ELV,paypal.FUNDING.IDEAL,paypal.FUNDING.BANCONTACT,paypal.FUNDING.GIROPAY,paypal.FUNDING.SOFORT,paypal.FUNDING.EPS,paypal.FUNDING.MYBANK,paypal.FUNDING.MYBANK,paypal.FUNDING.P24,paypal.FUNDING.ZIMPLER]}},wc_braintree.PayPal.prototype.get_button_container=function(){return t("#place_order").parent()},wc_braintree.PayPal.prototype.get_address_mappings=function(){return{recipientName:{set:function(e,a){var o=e.split(" ",2);1<=o.length&&t(a+"_first_name").val(o[0]),2<=o.length&&t(a+"_last_name").val(o[1])},get:function(e){return t(e+"_first_name").val()+" "+t(e+"_last_name").val()},required:!1},line1:{set:function(e,a){t(a+"_address_1").val(e)},get:function(e){return t(e+"_address_1").val()},required:!0},line2:{set:function(e,a){return t(a+"_address_2").val(e)},get:function(e){return t(e+"_address_2").val()},required:!1},city:{set:function(e,a){t(a+"_city").val(e)},get:function(e){return t(e+"_city").val()},required:!0},countryCode:{set:function(e,a){t(a+"_country").val(e)},get:function(e){return t(e+"_country").val()},required:!0},postalCode:{set:function(e,a){t(a+"_postcode").val(e)},get:function(e){return t(e+"_postcode").val()},required:!0},state:{set:function(e,a){t(a+"_state").val(e)},get:function(e){return t(e+"_state").val()},required:function(e){if("undefined"!=typeof wc_address_i18n_params){var a=JSON.parse(wc_address_i18n_params.locale),o=t(e+"_country").val();if(a&&a[o]&&a[o].state)return"undefined"==typeof a[o].state.required||a[o].state.required}return 0<t(e+"_state").length&&t(e+"_state").is(":visible")}},phone:{set:function(e){t("#billing_phone").val(e)},get:function(){return t("#billing_phone").val()},required:!1}}},wc_braintree.PayPal.prototype.update_addresses=function(e){if((!this.valid_address(this.get_address_object("#billing"),"#billing")||e.billingAddress)&&(e.billingAddress||e.shippingAddress&&!t("[name=\"ship_to_different_address\"]").is(":checked"))){var a=e.billingAddress?e.billingAddress:e.shippingAddress;a&&!t.isEmptyObject(a)&&this.populate_address_fields(a,"#billing")}this.populate_detail_fields(e),e.shippingAddress&&!t.isEmptyObject(e.shippingAddress)&&(0<t("[name^=\"shipping_\"]").length&&this.populate_address_fields(e.shippingAddress,"#shipping"),t("[name*=\"_state\"], [name*=\"_country\"]").trigger("change"))},wc_braintree.PayPal.prototype.populate_address_fields=function(e,a){t.each(this.get_address_mappings(),function(t,o){e[t]&&o.set(e[t],a)})},wc_braintree.PayPal.prototype.get_address_object=function(e){var a={};return t.each(this.get_address_mappings(),function(t,o){a[t]=o.get(e)}),a},wc_braintree.PayPal.prototype.valid_address=function(e,a){var o=!0;return!t.isEmptyObject(e)&&(mappings=this.get_address_mappings(),t.each(mappings,function(t,n){var r="function"==typeof n.required?n.required(a):n.required;r&&(!e[t]||"undefined"==typeof e[t]||0==e[t].length)&&(o=!1)}),o)},wc_braintree.PayPal.prototype.populate_detail_fields=function(e){e.firstName&&t("[name=\"billing_first_name\"]").val(e.firstName),e.lastName&&t("[name=\"billing_last_name\"]").val(e.lastName),e.email&&t("[name=\"billing_email\"]").val(e.email),e.phone&&t("[name=\"billing_phone\"]").val(e.phone)},wc_braintree.PayPal.prototype.get_address_hash=function(e){for(var t=["recipientName","line1","line2","city","state","postalCode","countryCode"],a=this.get_address_mappings(),o="",n=0;n<t.length;n++)a[t[n]]&&(o+=a[t[n]].get.call(this,e));return o},wc_braintree.PayPal.prototype.open_shipping_modal=function(e,a){function o(e){var a=t("<div>",{class:"wc-braintree-shipping-modal-overlay"}),o=t("<div>",{class:"wc-braintree-shipping-modal"});o.append(e).show(),t("body").addClass("shipping-modal-active").append(a).append(o),t("[name^=\"wc_shipping_method\"]").on("click",d.bind(this)),t(".wc-braintree-shipping-modal #place_order").on("click",r.bind(this)),t(".wc-braintree-shipping-modal #close").on("click",n)}function n(a){a.preventDefault(),t(".wc-braintree-shipping-modal-overlay").remove(),t(".wc-braintree-shipping-modal").remove(),t("body").removeClass("shipping-modal-active")}function r(t){n(t),this.process_order()}function i(){t("#preloaderSpinner").height(t(".paypal-shipping-methods").outerHeight()+20).show();var e=t(".wc-braintree-shipping-modal").height(),a=t(".wc-braintree-shipping-modal").scrollTop();t(".spinWrap").css("top",e/2+a)}function s(){t("#preloaderSpinner").hide()}function d(o){i();var e={};e[t(o.target).data("index")]=t(o.target).val(),this.update_shipping_method(e).then(function(e){s(),t(".cart-totals").replaceWith(e.data.cart_totals),a.onShippingMethodSelected&&a.onShippingMethodSelected.call(this,data)}.bind(this)).catch(function(){s()}.bind(this))}var p=this.params.shipping_window_url,a=a?a:{};e&&(p+=(-1==p.indexOf("?")?"?":"&")+t.param(e)),t.ajax({method:"GET",dataType:"html",url:p,success:function(e){this.unblock(),o.call(this,e)}.bind(this),error:function(){this.unblock()}.bind(this)})},wc_braintree.PayPal.prototype.map_shipping_address=function(e){return{address_1:e.line1,address_2:e.line2,city:e.city,postcode:e.postalCode,state:e.state,country:e.countryCode}},wc_braintree.GooglePay=function(){wc_braintree.BaseGateway.call(this),this.create_payments_client(),this.create_button()},wc_braintree.GooglePay.prototype=Object.create(wc_braintree.BaseGateway.prototype),wc_braintree.GooglePay.prototype.dynamic_price_enabled=function(){return"1"===this.params.dynamic_price},wc_braintree.GooglePay.prototype.get_environment=function(){return t("#wc_braintree_googlepay_environment").val()},wc_braintree.GooglePay.prototype.get_merchant_id=function(){return t("#wc_braintree_googlepay_merchant_id").val()},wc_braintree.GooglePay.prototype.get_total_price=function(){},wc_braintree.GooglePay.prototype.after_payment_data_callback=function(){},wc_braintree.GooglePay.prototype.create_payments_client=function(){var e={environment:this.get_environment()};this.dynamic_price_enabled()&&(e.paymentDataCallbacks={onPaymentAuthorized:function(){return new Promise(function(e){e({transactionState:"SUCCESS"})}.bind(this))}.bind(this)},this.needs_shipping()&&(e.paymentDataCallbacks.onPaymentDataChanged=function(e){return new Promise(function(t){this.payment_data_callback(e).then(function(e){t(e.data.requestUpdate),this.after_payment_data_callback(e.data)}.bind(this)).catch(function(e){t(e.data)}.bind(this))}.bind(this))}.bind(this))),this.paymentsClient=new google.payments.api.PaymentsClient(e)},wc_braintree.GooglePay.prototype.create_instance=function(t,e){return new Promise(function(t,a){this.clientInstance=e,braintree.googlePayment.create({client:e,googlePayVersion:2,googleMerchantId:this.get_merchant_id()},function(e,o){return e?void this.submit_error(e):void(this.googlePayInstance=o,this.initialize_fraud_tools(),this.paymentsClient.isReadyToPay({apiVersion:2,apiVersionMinor:0,allowedPaymentMethods:o.createPaymentDataRequest().allowedPaymentMethods}).then(function(e){e.result?(this.cannot_pay=!1,t(e)):(this.cannot_pay=!0,a(e))}.bind(this)).catch(function(e){this.submit_error({message:e.statusMessage})}.bind(this)))}.bind(this))}.bind(this))},wc_braintree.GooglePay.prototype.create_button=function(){return new Promise(function(e){this.$button&&this.$button.remove(),this.paymentsClient&&(this.$button=t(this.paymentsClient.createButton(t.extend({onClick:this.tokenize.bind(this)},this.params.button_options))),e())}.bind(this))},wc_braintree.GooglePay.prototype.tokenize=function(){var e=this.googlePayInstance.createPaymentDataRequest(this.get_payment_data_request()),a=e.allowedPaymentMethods[0];a.parameters.billingAddressRequired=!0,a.parameters.billingAddressParameters={format:"FULL",phoneNumberRequired:0<t("#billing_phone").length};try{this.paymentsClient.loadPaymentData(e).then(function(e){return this.paymentData=e,this.populate_address_fields(e),this.googlePayInstance.parseResponse(e)}.bind(this)).then(function(e){t(this.tokenized_response_selector).val(JSON.stringify(e)),this.set_nonce(e.nonce),this.set_device_data(),t("[name=\"payment_method\"]").val(this.gateway_id),this.on_payment_method_received(e)}.bind(this)).catch(function(e){if("CANCELED"!==e.statusCode){var t={code:-1<e.statusMessage.indexOf("whitelisted")?"DEVELOPER_ERROR_WHITELIST":null,message:e.statusMessage};this.submit_error(t)}}.bind(this))}catch(e){this.submit_error({message:e})}},wc_braintree.GooglePay.prototype.get_payment_data_request=function(){var e={transactionInfo:{currencyCode:t("#wc_braintree_cart_currency").val(),totalPriceStatus:"FINAL",totalPrice:this.get_total_price(),totalPriceLabel:this.params.price_label,displayItems:this.get_display_items()},emailRequired:!0};return this.dynamic_price_enabled()&&(this.needs_shipping()?(e.shippingAddressParameters={},e.shippingAddressRequired=!0,e.callbackIntents=["PAYMENT_AUTHORIZATION","SHIPPING_ADDRESS","SHIPPING_OPTION"],e.shippingOptionRequired=!0):e.callbackIntents=["PAYMENT_AUTHORIZATION"]),e},wc_braintree.GooglePay.prototype.get_display_items=function(){return t("#wc_braintree_googlepay_display_items").data("items")},wc_braintree.GooglePay.prototype.set_display_items=function(e){t("#wc_braintree_googlepay_display_items").data("items",e)},wc_braintree.GooglePay.prototype.populate_address_fields=function(e){e.paymentMethodData.info.billingAddress&&(this.populate_address(e.paymentMethodData.info.billingAddress,"#billing"),e.email&&t("#billing_email").val(e.email)),e.shippingAddress&&this.populate_address(e.shippingAddress,"#shipping")},wc_braintree.GooglePay.prototype.populate_address=function(e,a){t.each(this.get_address_mappings(),function(t,o){e[t]&&o.set(e[t],a)})},wc_braintree.GooglePay.prototype.payment_data_callback=function(e){return new Promise(function(a,o){t.when(this.api_update_address(e)).done(function(e){e.code?o(e.data):(a(e),this.set_selected_shipping_method(e.data.chosen_shipping_methods))}.bind(this))}.bind(this))},wc_braintree.GooglePay.prototype.api_update_address=function(e){return t.ajax({url:this.params.routes.shipping_data,method:"POST",dataType:"json",data:{address:e.shippingAddress,shippingOptions:e.shippingOptionData},beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",this.params._wp_rest_nonce)}.bind(this)})},wc_braintree.GooglePay.prototype.valid_address=function(e){var a=!0;return!t.isEmptyObject(e)&&(mappings=this.get_address_mappings(),t.each(mappings,function(t,o){o.required&&(!e[t]||"undefined"==typeof e[t]||0==e[t].length)&&(a=!1)}),a)},wc_braintree.GooglePay.prototype.get_address_object=function(e){var a={};return t.each(this.get_address_mappings(),function(t,o){a[t]=o.get(e)}),a},wc_braintree.GooglePay.prototype.get_address_hash=function(e){var a=this.get_address_mappings(),o="";return t.each(["name","postalCode","countryCode","address1","address2","locality","administrativeArea"],function(t,n){o+=a[n].get(e)}),o},wc_braintree.GooglePay.prototype.block=function(){t.blockUI({message:null,overlayCSS:{background:"#fff",opacity:.6}})},wc_braintree.GooglePay.prototype.unblock=function(){t.unblockUI()},wc_braintree.GooglePay.prototype.clear_error=function(){this.paymentData=null,t("#wc_braintree_checkout_error").remove()},wc_braintree.GooglePay.prototype.get_address_mappings=function(){return{name:{set:function(e,a){e=e.split(" "),1<=e.length&&t(a+"_first_name").val(e[0]),2<=e.length&&t(a+"_last_name").val(e[1])},get:function(e){var a="";return t(e+"_first_name").length&&(a=t(e+"_first_name").val()),t(e+"_last_name").length&&(a=""===a?t(e+"_last_name").val():" "+t(e+"_last_name").val()),a},required:!0},postalCode:{set:function(e,a){t(a+"_postcode").val(e)},get:function(e){return t(e+"_postcode").val()},required:!0},countryCode:{set:function(e,a){t(a+"_country").val(e)},get:function(e){return t(e+"_country").val()},required:!0},phoneNumber:{set:function(e,a){t(a+"_phone").val(e)},get:function(e){return t(e+"_phone").val()}},address1:{set:function(e,a){t(a+"_address_1").val(e)},get:function(e){return t(e+"_address_1").val()},required:!0},address2:{set:function(e,a){t(a+"_address_2").val(e)},get:function(e){return t(e+"_address_2").val()}},locality:{set:function(e,a){t(a+"_city").val(e)},get:function(e){return t(e+"_city").val()},required:!0},administrativeArea:{set:function(e,a){t(a+"_state").val(e)},get:function(e){return t(e+"_state").val()},required:!0}}},wc_braintree.CreditCard=function(){wc_braintree.BaseGateway.call(this),this._3ds_vaulted_nonce_selector="[name=\""+this.params._3ds_vaulted_nonce_selector+"\"]",this.config_selector="[name=\""+this.params.config_selector+"\"]"},wc_braintree.CreditCard.prototype=Object.create(wc_braintree.BaseGateway.prototype),wc_braintree.CreditCard.prototype.create_instance=function(t,e,a){this.clientInstance=e,this.client_token=a,this.config=e.getConfiguration().gatewayConfiguration,this.initialize_fraud_tools(),this.initialize_3d_secure()},wc_braintree.CreditCard.prototype.initialize_3d_secure=function(){this._3ds_enabled()&&braintree.threeDSecure.create({version:2,client:this.clientInstance},function(e,t){return e?(this.threeds_error=e,void this.submit_error(e)):void(this.threeDSecureInstance=t)}.bind(this))},wc_braintree.CreditCard.prototype.set_config_data=function(){t(this.config_selector).val(JSON.stringify(this.config))},wc_braintree.CreditCard.prototype.get_hosted_fields=function(){this.hosted_fields={};var e=this;return t.each(this.params.custom_fields,function(a,o){t("#"+o.id).length&&o.type&&(e.hosted_fields[o.type]={selector:"#"+o.id,placeholder:o.placeholder})}),t.each(this.hosted_fields,function(a,o){var n=!1;"cvv"===a?-1===e.config.challenges.indexOf("cvv")&&(n=!0):"postalCode"===a?-1===e.config.challenges.indexOf("postal_code")&&(n=!0):void 0,n&&(t(o.selector).closest("."+a+"-container").remove(),t(document.body).triggerHandler("wc_braintree_hosted_field_removed",a),delete e.hosted_fields[a])}),this.hosted_fields},wc_braintree.CreditCard.prototype._3ds_enabled=function(){return"1"===t("#wc_braintree_3ds_enabled").val()},wc_braintree.CreditCard.prototype._3ds_active=function(){return"1"===t("#wc_braintree_3ds_active").val()},wc_braintree.CreditCard.prototype.payment_nonce_request=function(e){return t.ajax({type:"POST",url:this.params.urls._3ds.vaulted_nonce,data:{_wpnonce:this.params._wp_rest_nonce,token:e,version:2}})},wc_braintree.CreditCard.prototype.get_tokenization_options=function(){var e={billingAddress:{}};return t("#billing_address_1").length&&(e.billingAddress.streetAddress=t("#billing_address_1").val()),t("#billing_postcode").length&&(e.billingAddress.postalCode=t("#billing_postcode").val()),e},wc_braintree.CreditCard.prototype.process_3dsecure=function(e,a){if(this.threeDSecureInstance){var o=this.get_shipping_prefix();this.threeDSecureInstance.verifyCard({amount:this.has_recurring_total()?this.get_recurring_cart_total():this.get_cart_total(),nonce:e.nonce,bin:e.details.bin,email:t("#billing_email").val(),billingAddress:{givenName:this.get_first_name("#billing").replace(/[^\x00-\x7f]/g,""),surname:this.get_last_name("#billing").replace(/[^\x00-\x7f]/g,""),phoneNumber:t("#billing_phone").val(),streetAddress:t("#billing_address_1").val(),extendedAddress:t("#billing_address_2").val(),locality:t("#billing_city").val(),region:t("#billing_state").val(),postalCode:t("#billing_postcode").val(),countryCodeAlpha2:t("#billing_country").val()},additionalInformation:this.needs_shipping()?{shippingGivenName:this.get_first_name(o).replace(/[^\x00-\x7f]/g,""),shippingSurname:this.get_last_name(o).replace(/[^\x00-\x7f]/g,""),shippingAddress:{streetAddress:t(o+"_address_1").val(),extendedAddress:t(o+"_address_2").val(),locality:t(o+"_city").val(),region:t(o+"_state").val(),postalCode:t(o+"_postcode").val(),countryCodeAlpha2:t(o+"_country").val()}}:{},onLookupComplete:function(e,t){this.remove_loader(),t()}.bind(this)},function(e,o){return e?(this.submit_error(e),void this.remove_loader()):void(a&&t(this._3ds_vaulted_nonce_selector).val("true"),this.on_payment_method_received(o))}.bind(this)),a&&this.unblock_form()}},wc_braintree.CreditCard.prototype.process_3dsecure_vaulted=function(){this.block_form(),t.when(this.payment_nonce_request(this.get_payment_token())).done(function(e){e.success?this.process_3dsecure(e.data,!0):(this.submit_error(e.message),this.unblock_form())}.bind(this)).fail(function(e,t,a){this.submit_error({message:a}),this.unblock_form()}.bind(this))},wc_braintree.CreditCard.prototype.add_icon_class=function(a,e,o){t(o).addClass(this.params.icon_style)},wc_braintree.CreditCard.prototype.add_icon_type=function(){t(this.container).find(".wc-braintree-payment-methods-container").addClass(this.params.icon_style+"-icons")},wc_braintree.CreditCard.prototype.block_form=function(){t(this.container).closest("form").block(wc_braintree.blockUI)},wc_braintree.CreditCard.prototype.unblock_form=function(){t(this.container).closest("form").unblock()},wc_braintree.CreditCard.prototype.display_loader=function(){this.params.loader.enabled&&t(".wc-braintree-payment-loader").fadeIn(200)},wc_braintree.CreditCard.prototype.remove_loader=function(){t(".wc-braintree-payment-loader").fadeOut(200)},wc_braintree.ApplePay=function(){if(wc_braintree.BaseGateway.call(this),"undefined"==typeof this.get_total_price)throw"get_total_price function must be implemented."},wc_braintree.ApplePay.prototype=Object.create(wc_braintree.BaseGateway.prototype),wc_braintree.ApplePay.prototype.create_instance=function(t,e){return this.clientInstance=e,this.initialize_fraud_tools(),new Promise(function(e,t){this.can_initialize_applepay()?braintree.applePay.create({client:this.clientInstance},function(a,o){if(a)return t(),void this.submit_error(a);this.applePayInstance=o;var n=ApplePaySession.canMakePaymentsWithActiveCard(o.merchantIdentifier);n.then(function(a){a?e():t()})}.bind(this)):t()}.bind(this))},wc_braintree.ApplePay.prototype.open_wallet=function(){this.applePaySession.begin()},wc_braintree.ApplePay.prototype.init_wallet=function(){var e=this.applePayInstance.createPaymentRequest(this.get_payment_request());try{var a=new ApplePaySession(this.get_applepay_version(),e);this.applePaySession=a,a.onvalidatemerchant=this.onvalidatemerchant.bind(this),this.needs_shipping()||t(document.body).hasClass("woocommerce-change-payment-method")||t(document.body).hasClass("woocommerce-order-pay")||(a.onpaymentmethodselected=this.onpaymentmethodselected.bind(this)),this.needs_shipping()&&(a.onshippingcontactselected=this.onshippingcontactselected.bind(this),a.onshippingmethodselected=this.onshippingmethodselected.bind(this)),a.onpaymentauthorized=this.onpaymentauthorized.bind(this)}catch(e){this.submit_error(e)}},wc_braintree.ApplePay.prototype.get_applepay_version=function(){if(ApplePaySession.supportsVersion(4))return 4;return ApplePaySession.supportsVersion(3)?3:void 0},wc_braintree.ApplePay.prototype.get_payment_request=function(){return{total:{label:this.params.store_name,amount:this.get_total_price(),type:"final"},lineItems:this.get_line_items(),currencyCode:this.get_currency(),requiredBillingContactFields:this.get_billing_fields_array(),requiredShippingContactFields:this.get_shipping_fields_array()}},wc_braintree.ApplePay.prototype.get_line_items=function(){return t("#wc_braintree_applepay_line_items").data("items")},wc_braintree.ApplePay.prototype.set_line_items=function(e){t("#wc_braintree_applepay_line_items").data("items",e)},wc_braintree.ApplePay.prototype.get_address_mappings=function(){return{givenName:{get:function(e){return t(e+"_first_name").val()},set:function(e,a){t(a+"_first_name").val(e)},contactField:"name",isValid:function(e){return"undefined"!=typeof e&&"string"==typeof e&&""!==e.trim()}},familyName:{get:function(e){return t(e+"_last_name").val()},set:function(e,a){t(a+"_last_name").val(e)},contactField:"name",isValid:function(e){return"undefined"!=typeof e&&"string"==typeof e&&""!==e.trim()}},addressLines:{get:function(e){var a=[];return""!=t(e+"_address_1").val()&&a.push(t(e+"_address_1").val()),""!=t(e+"_address_2").val()&&a.push(t(e+"_address_2").val()),a},set:function(e,a){t(a+"_address_1").val(e[0]),2==e.length&&t(a+"_address_2").val(e[1])},contactField:"addressLines",isValid:function(e){var t=e[0];return"undefined"!=typeof t&&("string"!=typeof t||""!==t.trim())}},administrativeArea:{get:function(e){return t(e+"_state").val()},set:function(e,a){2==e.length?t(a+"_state").val(e.toUpperCase()):t(a+"_state option").each(function(){var o=t(this),n=o.text().toLowerCase();e=e.toLowerCase(),0<=n.indexOf(e)&&t(a+"_state").val(o.val())})},contactField:"administrativeArea",isValid:function(e,a){var o=this.params.states[a.countryCode];return!o||t.isEmptyObject(o)||"undefined"!=typeof e&&"string"==typeof e&&""!==e.trim()&&"undefined"!=typeof o[e]}},locality:{get:function(e){return t(e+"_city").val()},set:function(e,a){t(a+"_city").val(e)},contactField:"locality",isValid:function(e){return"undefined"!=typeof e&&"string"==typeof e&&""!==e.trim()}},postalCode:{get:function(e){return t(e+"_postcode").val()},set:function(e,a){t(a+"_postcode").val(e)},contactField:"postalCode",isValid:function(e){return"undefined"!=typeof e&&"string"==typeof e&&""!==e.trim()}},phoneNumber:{get:function(){return t("#billing_phone").val()},set:function(e){t("#billing_phone").val(e)},contactField:"phoneNumber",isValid:function(e){return"undefined"!=typeof e&&"string"==typeof e&&""!==e.trim()}},emailAddress:{get:function(){return t("#billing_email").val()},set:function(e){t("#billing_email").val(e)},contactField:"emailAddress",isValid:function(e){return"undefined"!=typeof e&&"string"==typeof e&&""!==e.trim()}},countryCode:{get:function(e){return t(e+"_country").val()},set:function(e,a){t(a+"_country").val(e.toUpperCase())},contactField:"countryCode",isValid:function(e){return"undefined"!=typeof e&&"string"==typeof e&&""!==e.trim()}}}},wc_braintree.ApplePay.prototype.populate_address_fields=function(e,t){var a=this.get_address_mappings();for(var o in e)if(a[o]){var n=e[o];a[o].set.call(this,n,t)}},wc_braintree.ApplePay.prototype.get_address_hash=function(e){var a=this.get_address_mappings(),o="";return t.each(["givenName","familyName","addressLines","administrativeArea","locality","postalCode","countryCode"],function(t,n){o+=a[n].get(e)}),o},wc_braintree.ApplePay.prototype.validate_response=function(e){var t=[],a=this.get_address_mappings(),o=this.params.messages.errors;if(e.shippingContact){var n=this.needs_shipping()?a:{emailAddress:a.emailAddress,phoneNumber:a.phoneNumber};for(var r in e.shippingContact)if(n[r]){var i=e.shippingContact[r];n[r].isValid.call(this,i,e.shippingContact)||t.push(new ApplePayError("shippingContactInvalid",n[r].contactField))}}if(e.billingContact)for(var r in e.billingContact)if(a[r]){var i=e.billingContact[r];if(!a[r].isValid.call(this,i,e.billingContact)){var s=o["invalid_"+a[r].contactField]?o["invalid_"+a[r].contactField]:"";t.push(new ApplePayError("billingContactInvalid",a[r].contactField,s))}}return t},wc_braintree.ApplePay.prototype.get_billing_fields_array=function(){return["postalAddress"]},wc_braintree.ApplePay.prototype.get_shipping_fields_array=function(){var e=[];return this.needs_shipping()&&e.push("name","postalAddress"),t("#billing_email").length&&e.push("email"),t("#billing_phone").length&&e.push("phone"),e},wc_braintree.ApplePay.prototype.populate_address_data=function(e){return new Promise(function(t){e.shippingContact&&this.populate_address_fields(e.shippingContact,"#shipping"),e.billingContact&&this.populate_address_fields(e.billingContact,"#billing"),t(e)}.bind(this))},wc_braintree.ApplePay.prototype.can_initialize_applepay=function(){return window.ApplePaySession&&ApplePaySession.canMakePayments()},wc_braintree.ApplePay.prototype.has_nonce=function(){return 0<t(this.nonce_selector).val().length},wc_braintree.ApplePay.prototype.onvalidatemerchant=function(e){this.applePayInstance.performValidation({validationURL:e.validationURL,displayName:this.params.store_name},function(e,t){return e?(this.submit_error(e),void this.applePaySession.abort()):void this.applePaySession.completeMerchantValidation(t)}.bind(this))},wc_braintree.ApplePay.prototype.onshippingcontactselected=function(e){this.update_shipping_address({country:e.shippingContact.countryCode,state:e.shippingContact.administrativeArea,postcode:e.shippingContact.postalCode,city:e.shippingContact.locality}).then(function(e){this.can_ship=!0,this.applePaySession.completeShippingContactSelection(e.data.shippingContactUpdate)}.bind(this)).catch(function(e){"addressUnserviceable"===e.code?(this.can_ship=!1,this.applePaySession.completeShippingContactSelection(e.data.shippingContactUpdate)):this.applePaySession.completeShippingContactSelection({errors:[new ApplePayError(e.code,e.data.contactField,e.message)],newTotal:e.data.newTotal,newShippingMethods:e.data.newShippingMethods})}.bind(this))},wc_braintree.ApplePay.prototype.onshippingmethodselected=function(e){var t=e.shippingMethod.identifier,a={},o=t.match(/([\w]+)\:(.+)/);a[o[1]]=o[2],this.update_shipping_method(a).then(function(e){e.code?(this.applePaySession.abort(),this.submit_error(e.messages)):this.applePaySession.completeShippingMethodSelection(e.data.shippingMethodUpdate)}.bind(this)).catch(function(){this.applePaySession.abort(),this.submit_error(errorThrown)}.bind(this))},wc_braintree.ApplePay.prototype.onpaymentmethodselected=function(){t.ajax({url:this.params.routes.applepay_payment_method,method:"POST",dataType:"json",beforeSend:function(e){e.setRequestHeader("X-WP-Nonce",this.params._wp_rest_nonce)}.bind(this),success:function(e){return e.success?void this.applePaySession.completePaymentMethodSelection(e.data):(this.applePaySession.abort(),void this.submit_error(e.messages))}.bind(this),error:function(e,t,a){this.applePaySession.abort(),this.submit_error(a)}.bind(this)})},wc_braintree.ApplePay.prototype.onpaymentauthorized=function(e){return new Promise(function(a,o){this.applePayInstance.tokenize({token:e.payment.token},function(n,r){if(n)return this.submit_error(n),void this.applePaySession.completePayment(ApplePaySession.STATUS_FAILURE);var i=this.validate_response(e.payment);0<i.length?(this.applePaySession.completePayment({status:ApplePaySession.STATUS_FAILURE,errors:i}),o(r)):this.needs_shipping()&&!this.can_ship?(this.applePaySession.completePayment({status:ApplePaySession.STATUS_FAILURE,errors:[new ApplePayError("addressUnserviceable")]}),o(r)):(this.applePaySession.completePayment(ApplePaySession.STATUS_SUCCESS),this.set_nonce(r.nonce),this.set_device_data(),this.populate_address_data(e.payment),t("[name=\"payment_method\"]").val(this.gateway_id),this.on_payment_method_received(r),a(r))}.bind(this))}.bind(this))}})(jQuery);